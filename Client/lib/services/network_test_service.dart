import "dart:async";import "package:http/http.dart" as http;class NetworkTestResult{final double latency;final double downloadSpeed;final double uploadSpeed;final double jitter;NetworkTestResult({required this.latency,this.downloadSpeed=0,this.uploadSpeed=0,this.jitter=0});}class PingResult{final String host;final double latency;final bool success;PingResult({required this.host,this.latency=0,this.success=false});}class NetworkTestService{static final NetworkTestService _i=NetworkTestService._();factory NetworkTestService()=>_i;NetworkTestService._();Future<PingResult>ping(String h)async{final s=Stopwatch()..start();try{final r=await http.head(Uri.parse(h.startsWith("http")?h:"https://\$h")).timeout(Duration(seconds:5));s.stop();return PingResult(host:h,latency:s.elapsedMilliseconds.toDouble(),success:r.statusCode<400);}catch(e){return PingResult(host:h,success:false);}}Future<double>measureDownloadSpeed()async{final s=Stopwatch()..start();int b=0;try{final c=http.Client();final r=await c.send(http.Request("GET",Uri.parse("https://speed.cloudflare.com/__down?bytes=10000000")));await for(final ch in r.stream.timeout(Duration(seconds:8))){b+=ch.length;}s.stop();c.close();return(b*8/s.elapsedMilliseconds*1000)/1000000;}catch(e){return 0;}}Future<NetworkTestResult>runFullTest()async{final l=await ping("google.com");final d=await measureDownloadSpeed();return NetworkTestResult(latency:l.latency,downloadSpeed:d);}}
