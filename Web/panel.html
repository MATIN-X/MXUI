<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MXUI Panel</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="panel.css">
</head>
<body class="dark">
    <!-- Preloader -->
    <div id="preloader" class="preloader">
        <div class="loader">
            <div class="loader-logo">MX</div>
            <div class="loader-text">MXUI Panel</div>
            <div class="loader-bar"><div class="loader-progress"></div></div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app" id="app">
        <!-- Desktop Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-icon">MX</div>
                    <span class="logo-text">MXUI</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">اصلی</div>
                    <a class="nav-item active" data-page="home">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                        </span>
                        <span class="nav-text">خانه</span>
                    </a>
                    <a class="nav-item" data-page="users">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                            </svg>
                        </span>
                        <span class="nav-text">کاربران</span>
                        <span class="nav-badge" id="usersCount">0</span>
                    </a>
                    <a class="nav-item owner-only" data-page="admins">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                            </svg>
                        </span>
                        <span class="nav-text">ادمین‌ها</span>
                    </a>
                </div>

                <div class="nav-section owner-only">
                    <div class="nav-section-title">تنظیمات</div>
                    <a class="nav-item" data-page="core">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                            </svg>
                        </span>
                        <span class="nav-text">هسته</span>
                    </a>
                    <a class="nav-item" data-page="nodes">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                                <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                                <line x1="6" y1="6" x2="6.01" y2="6"/>
                                <line x1="6" y1="18" x2="6.01" y2="18"/>
                            </svg>
                        </span>
                        <span class="nav-text">نودها</span>
                        <span class="nav-badge success" id="nodesCount">1</span>
                    </a>
                    <a class="nav-item" data-page="panel">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                        </span>
                        <span class="nav-text">پنل</span>
                    </a>
                    <a class="nav-item" data-page="template">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                        </span>
                        <span class="nav-text">قالب</span>
                    </a>
                </div>

                <div class="nav-section owner-only">
                    <div class="nav-section-title">ابزارها</div>
                    <a class="nav-item" data-page="message">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                            </svg>
                        </span>
                        <span class="nav-text">پیام</span>
                    </a>
                    <a class="nav-item" data-page="bot">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="10" rx="2"/>
                                <circle cx="12" cy="5" r="2"/>
                                <path d="M12 7v4"/>
                                <line x1="8" y1="16" x2="8" y2="16"/>
                                <line x1="16" y1="16" x2="16" y2="16"/>
                            </svg>
                        </span>
                        <span class="nav-text">ربات فروش</span>
                    </a>
                    <a class="nav-item" data-page="ai">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a4 4 0 014 4v2a4 4 0 01-8 0V6a4 4 0 014-4z"/>
                                <path d="M16 10v2a4 4 0 01-8 0v-2"/>
                                <path d="M8 14v4a4 4 0 008 0v-4"/>
                                <circle cx="12" cy="18" r="2"/>
                            </svg>
                        </span>
                        <span class="nav-text">هوش مصنوعی</span>
                        <span class="nav-badge warning">Beta</span>
                    </a>
                    <a class="nav-item" data-page="database">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                            </svg>
                        </span>
                        <span class="nav-text">دیتابیس</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">سیستم</div>
                    <a class="nav-item" href="https://github.com/matin-x/mxui" target="_blank">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/>
                            </svg>
                        </span>
                        <span class="nav-text">گیت‌هاب</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-version">v1.0.0</div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="topbar-btn mobile-menu-btn" id="mobileMenuBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <line x1="3" y1="18" x2="21" y2="18"/>
                        </svg>
                    </button>
                    <h1 class="page-title" id="pageTitle">خانه</h1>
                </div>
                <div class="topbar-right">
                    <select class="lang-select" id="langSelect">
                        <option value="fa">فارسی</option>
                        <option value="en">English</option>
                        <option value="ru">Русский</option>
                        <option value="zh">中文</option>
                    </select>
                    <button class="topbar-btn" id="themeToggle" title="تغییر تم">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                        </svg>
                    </button>
                    <button class="topbar-btn" id="refreshBtn" title="بروزرسانی">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <polyline points="1 20 1 14 7 14"/>
                            <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                        </svg>
                    </button>
                    <button class="topbar-btn notification-btn" id="notificationBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 01-3.46 0"/>
                        </svg>
                        <span class="notification-dot" id="notificationDot"></span>
                    </button>
                    <!-- Profile Button -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <button class="profile-btn" id="profileBtn">
                            <span class="profile-avatar" id="profileAvatar">A</span>
                        </button>
                        <div class="profile-menu" id="profileMenu">
                            <div class="profile-header">
                                <div class="profile-avatar-lg" id="profileAvatarLg">A</div>
                                <div class="profile-info">
                                    <div class="profile-name" id="profileName">Admin</div>
                                    <div class="profile-role" id="profileRole">مالک</div>
                                </div>
                            </div>
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <span class="stat-value" id="profileUsers">0</span>
                                    <span class="stat-label">کاربران</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="stat-value" id="profileTraffic">0 GB</span>
                                    <span class="stat-label">ترافیک</span>
                                </div>
                            </div>
                            <div class="profile-actions">
                                <button class="profile-action-btn" onclick="openSettings()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"/>
                                        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                                    </svg>
                                    تنظیمات
                                </button>
                                <button class="profile-action-btn danger" onclick="logout()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                        <polyline points="16 17 21 12 16 7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                    خروج
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content Container -->
            <div class="page-container" id="pageContainer">
                <!-- Pages will be loaded here dynamically -->
            </div>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="bottom-nav" id="bottomNav">
            <a class="bottom-nav-item active" data-page="home">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <span>خانه</span>
            </a>
            <a class="bottom-nav-item" data-page="users">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                </svg>
                <span>کاربران</span>
            </a>
            <a class="bottom-nav-item owner-only" data-page="admins">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <span>ادمین‌ها</span>
            </a>
            <a class="bottom-nav-item owner-only" data-page="core">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                </svg>
                <span>تنظیمات</span>
            </a>
            <a class="bottom-nav-item" data-page="profile-mobile">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>پروفایل</span>
            </a>
        </nav>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-container" id="modalContainer">
            <!-- Modals will be loaded here -->
        </div>
    </div>

    <!-- Page Templates -->
    <template id="tpl-home">
        <div class="page-content fade-in">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card glass">
                    <div class="stat-icon primary">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="statTotalUsers">0</div>
                        <div class="stat-label">کل کاربران</div>
                        <div class="stat-change up" id="statNewUsers">+0 امروز</div>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon success">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="statActiveUsers">0</div>
                        <div class="stat-label">کاربران فعال</div>
                        <div class="stat-online">
                            <span class="online-dot"></span>
                            <span id="statOnlineUsers">0 آنلاین</span>
                        </div>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon info">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="statTotalTraffic">0 GB</div>
                        <div class="stat-label">ترافیک کل</div>
                        <div class="stat-sub">
                            <span class="up">↑ <span id="statUpload">0</span></span>
                            <span class="down">↓ <span id="statDownload">0</span></span>
                        </div>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                            <line x1="6" y1="6" x2="6.01" y2="6"/>
                            <line x1="6" y1="18" x2="6.01" y2="18"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="statNodes">1/1</div>
                        <div class="stat-label">نودها</div>
                        <div class="stat-badge success">آنلاین</div>
                    </div>
                </div>
            </div>

            <!-- System Resources (Owner Only) -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                        وضعیت سیستم
                    </h3>
                    <button class="btn btn-sm" onclick="refreshSystemStats()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                        </svg>
                    </button>
                </div>
                <div class="card-body">
                    <div class="system-grid">
                        <div class="system-item">
                            <div class="system-label">CPU</div>
                            <div class="system-value" id="sysCpu">0%</div>
                            <div class="progress">
                                <div class="progress-bar" id="sysCpuBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="system-item">
                            <div class="system-label">RAM</div>
                            <div class="system-value" id="sysRam">0 / 0 GB</div>
                            <div class="progress">
                                <div class="progress-bar success" id="sysRamBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="system-item">
                            <div class="system-label">حافظه</div>
                            <div class="system-value" id="sysDisk">0 / 0 GB</div>
                            <div class="progress">
                                <div class="progress-bar warning" id="sysDiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="system-item">
                            <div class="system-label">شبکه</div>
                            <div class="system-value" id="sysNetwork">
                                <span class="up">↑ 0 KB/s</span>
                                <span class="down">↓ 0 KB/s</span>
                            </div>
                        </div>
                    </div>
                    <div class="ip-boxes">
                        <div class="ip-box">
                            <span class="ip-label">IPv4</span>
                            <span class="ip-value" id="sysIpv4">---</span>
                            <button class="btn btn-icon btn-sm" onclick="copyText(document.getElementById('sysIpv4').textContent)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ip-box">
                            <span class="ip-label">IPv6</span>
                            <span class="ip-value" id="sysIpv6">---</span>
                            <button class="btn btn-icon btn-sm" onclick="copyText(document.getElementById('sysIpv6').textContent)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Core Status & Actions (Owner Only) -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                        </svg>
                        وضعیت هسته
                    </h3>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-success" onclick="restartCore()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                            </svg>
                            ریبوت
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="stopCore()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="6" width="12" height="12"/>
                            </svg>
                            توقف
                        </button>
                        <button class="btn btn-sm" onclick="showLogs()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            لاگ
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="core-status">
                        <div class="core-indicator" id="coreIndicator">
                            <span class="core-dot running"></span>
                            <span class="core-text" id="coreStatusText">در حال اجرا</span>
                        </div>
                        <div class="core-version" id="coreVersion">Xray v1.8.4</div>
                        <div class="core-uptime">آپتایم: <span id="coreUptime">0 روز 0 ساعت</span></div>
                    </div>
                </div>
            </div>

            <!-- Traffic Chart -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        ترافیک لایو
                    </h3>
                    <select class="form-select form-select-sm" id="chartPeriod" onchange="updateChart(this.value)">
                        <option value="hour">ساعت اخیر</option>
                        <option value="day" selected>امروز</option>
                        <option value="week">هفته</option>
                        <option value="month">ماه</option>
                    </select>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Quick Backup -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        بکاپ سریع
                    </h3>
                </div>
                <div class="card-body">
                    <div class="backup-actions">
                        <button class="btn btn-primary" onclick="createBackup()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            ایجاد بکاپ
                        </button>
                        <button class="btn" onclick="document.getElementById('restoreInput').click()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            بازیابی
                        </button>
                        <input type="file" id="restoreInput" accept=".zip" style="display:none" onchange="restoreBackup(this.files[0])">
                    </div>
                </div>
            </div>

            <!-- Connection Logs (Owner Only) -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        لاگ اتصالات
                    </h3>
                    <button class="btn btn-sm" onclick="clearLogs()">پاکسازی</button>
                </div>
                <div class="card-body">
                    <div class="log-container" id="connectionLogs">
                        <div class="log-empty">بدون لاگ</div>
                    </div>
                </div>
            </div>

            <!-- Nodes Status (Owner Only) -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                            <line x1="6" y1="6" x2="6.01" y2="6"/>
                            <line x1="6" y1="18" x2="6.01" y2="18"/>
                        </svg>
                        وضعیت نودها
                    </h3>
                </div>
                <div class="card-body">
                    <div class="nodes-list" id="nodesStatus">
                        <!-- Nodes will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Power Actions (Owner Only) -->
            <div class="card glass owner-only">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18.36 6.64a9 9 0 11-12.73 0"/>
                            <line x1="12" y1="2" x2="12" y2="12"/>
                        </svg>
                        عملیات سیستم
                    </h3>
                </div>
                <div class="card-body">
                    <div class="power-actions">
                        <button class="btn btn-warning" onclick="restartPanel()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                            </svg>
                            ریستارت پنل
                        </button>
                        <button class="btn btn-danger" onclick="restartServer()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18.36 6.64a9 9 0 11-12.73 0"/>
                                <line x1="12" y1="2" x2="12" y2="12"/>
                            </svg>
                            ریستارت سرور
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Users Page Template -->
    <template id="tpl-users">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                        مدیریت کاربران
                    </h3>
                    <div class="card-actions">
                        <button class="btn btn-primary" onclick="openAddUserModal()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            کاربر جدید
                        </button>
                        <button class="btn" onclick="exportUsers()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Excel
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="filter-bar">
                        <div class="search-box">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            </svg>
                            <input type="text" id="userSearch" placeholder="جستجو..." oninput="filterUsers()">
                        </div>
                        <select class="form-select owner-only" id="adminFilter" onchange="filterUsers()">
                            <option value="">همه ادمین‌ها</option>
                        </select>
                        <select class="form-select" id="statusFilter" onchange="filterUsers()">
                            <option value="">همه وضعیت‌ها</option>
                            <option value="active">فعال</option>
                            <option value="expired">منقضی</option>
                            <option value="limited">محدود</option>
                            <option value="disabled">غیرفعال</option>
                            <option value="on_hold">انتظار</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>کاربر</th>
                                    <th>وضعیت</th>
                                    <th>ترافیک</th>
                                    <th>انقضا</th>
                                    <th>آنلاین</th>
                                    <th class="owner-only">سازنده</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="usersPagination"></div>
                </div>
            </div>
        </div>
    </template>

    <!-- Admins Page Template -->
    <template id="tpl-admins">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        مدیریت ادمین‌ها
                    </h3>
                    <button class="btn btn-primary" onclick="openAddAdminModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        ادمین جدید
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>نام کاربری</th>
                                    <th>نقش</th>
                                    <th>کاربران</th>
                                    <th>مصرف ماهانه</th>
                                    <th>مصرف کل</th>
                                    <th>وضعیت</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <!-- Admins will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Core Settings Page Template -->
    <template id="tpl-core">
        <div class="page-content fade-in">
            <!-- Protocol Settings -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        پروتکل‌ها
                    </h3>
                </div>
                <div class="card-body">
                    <div class="protocols-grid" id="protocolsGrid">
                        <!-- Protocols will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Inbound Settings -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/>
                            <path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/>
                        </svg>
                        تنظیمات Inbound
                    </h3>
                    <button class="btn btn-primary" onclick="openAddInboundModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        اضافه کردن
                    </button>
                </div>
                <div class="card-body">
                    <div class="inbounds-list" id="inboundsList">
                        <!-- Inbounds will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Outbound Settings -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                        تنظیمات Outbound
                    </h3>
                </div>
                <div class="card-body">
                    <div class="outbounds-list" id="outboundsList">
                        <!-- Outbounds will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- WARP Settings -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
                        </svg>
                        WARP کلودفلر
                    </h3>
                </div>
                <div class="card-body">
                    <div class="warp-settings">
                        <div class="form-group">
                            <div class="form-switch">
                                <label class="switch">
                                    <input type="checkbox" id="warpEnabled">
                                    <span class="slider"></span>
                                </label>
                                <span>فعال‌سازی WARP</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">License Key</label>
                            <input type="text" class="form-control" id="warpLicense" placeholder="Enter WARP+ license key">
                        </div>
                        <button class="btn btn-primary" onclick="saveWarpSettings()">ذخیره</button>
                    </div>
                </div>
            </div>

            <!-- Routing & DNS -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="22" y1="12" x2="18" y2="12"/>
                            <line x1="6" y1="12" x2="2" y2="12"/>
                            <line x1="12" y1="6" x2="12" y2="2"/>
                            <line x1="12" y1="22" x2="12" y2="18"/>
                        </svg>
                        مسیریابی و DNS
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">سرور DNS</label>
                        <input type="text" class="form-control" id="dnsServer" value="8.8.8.8">
                    </div>
                    <div class="form-group">
                        <label class="form-label">DNS Strategy</label>
                        <select class="form-select" id="dnsStrategy">
                            <option value="UseIP">UseIP</option>
                            <option value="UseIPv4">UseIPv4</option>
                            <option value="UseIPv6">UseIPv6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">سایت‌های مسدود</label>
                        <textarea class="form-control" id="blockedSites" rows="4" placeholder="هر سایت در یک خط..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">سایت‌های مستقیم (بدون پراکسی)</label>
                        <textarea class="form-control" id="directSites" rows="4" placeholder="هر سایت در یک خط..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">پورت‌های مسدود</label>
                        <input type="text" class="form-control" id="blockedPorts" placeholder="مثال: 25,110,143">
                    </div>
                    <button class="btn btn-primary" onclick="saveRoutingSettings()">ذخیره تنظیمات</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Nodes Page Template -->
    <template id="tpl-nodes">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                            <line x1="6" y1="6" x2="6.01" y2="6"/>
                            <line x1="6" y1="18" x2="6.01" y2="18"/>
                        </svg>
                        مدیریت نودها
                    </h3>
                    <button class="btn btn-primary" onclick="openAddNodeModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        نود جدید
                    </button>
                </div>
                <div class="card-body">
                    <div class="nodes-grid" id="nodesGrid">
                        <!-- Nodes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Panel Settings Page Template -->
    <template id="tpl-panel">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="9" y1="21" x2="9" y2="9"/>
                        </svg>
                        تنظیمات پنل
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">پورت پنل</label>
                        <input type="number" class="form-control" id="panelPort" value="8443">
                    </div>
                    <div class="form-group">
                        <label class="form-label">مسیر لاگین</label>
                        <input type="text" class="form-control" id="panelPath" value="/dashboard">
                    </div>
                    <div class="form-group">
                        <label class="form-label">لینک ساب‌اسکریپشن</label>
                        <input type="text" class="form-control" id="subUrl" readonly>
                        <button class="btn btn-sm mt-2" onclick="copyText(document.getElementById('subUrl').value)">کپی</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">پورت ساب‌اسکریپشن</label>
                        <input type="number" class="form-control" id="subPort" value="443">
                    </div>
                    <button class="btn btn-primary" onclick="savePanelSettings()">ذخیره تنظیمات</button>
                </div>
            </div>

            <!-- Telegram Bot 1 (Backup Bot) -->
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                        ربات بکاپ (تلگرام)
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">توکن ربات</label>
                        <input type="text" class="form-control" id="backupBotToken" placeholder="123456:ABC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">آیدی عددی ادمین</label>
                        <input type="text" class="form-control" id="backupBotAdmin" placeholder="123456789">
                    </div>
                    <div class="form-group">
                        <div class="form-switch">
                            <label class="switch">
                                <input type="checkbox" id="autoBackupEnabled">
                                <span class="slider"></span>
                            </label>
                            <span>بکاپ خودکار روزانه</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveBackupBotSettings()">ذخیره</button>
                    <button class="btn" onclick="testBackupBot()">تست اتصال</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Template Management Page -->
    <template id="tpl-template">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                        مدیریت قالب‌ها
                    </h3>
                </div>
                <div class="card-body">
                    <div class="templates-grid">
                        <div class="template-card" onclick="selectTemplate('subscription')">
                            <div class="template-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                            </div>
                            <div class="template-name">صفحه ساب‌اسکریپشن</div>
                            <div class="template-desc">صفحه نمایش لینک‌های کاربر</div>
                        </div>
                        <div class="template-card" onclick="selectTemplate('decoy')">
                            <div class="template-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="3" y1="9" x2="21" y2="9"/>
                                </svg>
                            </div>
                            <div class="template-name">صفحه Decoy</div>
                            <div class="template-desc">صفحه فریب (برای امنیت)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card glass" id="templateEditor" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">ویرایشگر قالب</h3>
                    <div class="card-actions">
                        <button class="btn" onclick="previewTemplate()">پیش‌نمایش</button>
                        <button class="btn btn-primary" onclick="saveTemplate()">ذخیره</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">کد HTML</label>
                        <textarea class="form-control code-editor" id="templateCode" rows="20"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">آپلود فایل HTML</label>
                        <input type="file" class="form-control" id="templateFile" accept=".html,.htm" onchange="loadTemplateFile(this.files[0])">
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Message Page Template -->
    <template id="tpl-message">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                        </svg>
                        ارسال پیام به کاربران
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">گیرندگان</label>
                        <select class="form-select" id="messageRecipients">
                            <option value="all">همه کاربران</option>
                            <option value="active">کاربران فعال</option>
                            <option value="expired">کاربران منقضی</option>
                            <option value="expiring">در حال انقضا (۷ روز)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">عنوان</label>
                        <input type="text" class="form-control" id="messageTitle" placeholder="عنوان پیام...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">متن پیام</label>
                        <textarea class="form-control" id="messageContent" rows="6" placeholder="متن پیام خود را بنویسید..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                        ارسال پیام
                    </button>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">پیام‌های ارسال شده</h3>
                </div>
                <div class="card-body">
                    <div class="messages-list" id="sentMessagesList">
                        <!-- Sent messages will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Bot (Sales) Page Template -->
    <template id="tpl-bot">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="10" rx="2"/>
                            <circle cx="12" cy="5" r="2"/>
                            <path d="M12 7v4"/>
                        </svg>
                        ربات فروش خودکار
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">توکن ربات</label>
                        <input type="text" class="form-control" id="salesBotToken" placeholder="123456:ABC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">آیدی عددی ادمین‌ها</label>
                        <input type="text" class="form-control" id="salesBotAdmins" placeholder="123456789,987654321">
                        <small class="text-muted">با کاما جدا کنید</small>
                    </div>
                    <div class="form-group">
                        <div class="form-switch">
                            <label class="switch">
                                <input type="checkbox" id="salesBotEnabled">
                                <span class="slider"></span>
                            </label>
                            <span>فعال‌سازی ربات</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSalesBotSettings()">ذخیره</button>
                    <button class="btn" onclick="testSalesBot()">تست اتصال</button>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">مدیریت پلن‌ها</h3>
                    <button class="btn btn-primary" onclick="openAddPlanModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        پلن جدید
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>نام پلن</th>
                                    <th>مدت (روز)</th>
                                    <th>حجم (GB)</th>
                                    <th>قیمت</th>
                                    <th>تست</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="plansTableBody">
                                <!-- Plans will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">کاربران ربات</h3>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>آیدی تلگرام</th>
                                    <th>نام</th>
                                    <th>سرویس‌ها</th>
                                    <th>تاریخ عضویت</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="botUsersTableBody">
                                <!-- Bot users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- AI Page Template -->
    <template id="tpl-ai">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 014 4v2a4 4 0 01-8 0V6a4 4 0 014-4z"/>
                            <path d="M16 10v2a4 4 0 01-8 0v-2"/>
                            <path d="M8 14v4a4 4 0 008 0v-4"/>
                            <circle cx="12" cy="18" r="2"/>
                        </svg>
                        دستیار هوشمند MXUI
                        <span class="badge warning">Beta</span>
                    </h3>
                </div>
                <div class="card-body">
                    <div class="ai-config">
                        <div class="form-group">
                            <label class="form-label">سرویس AI</label>
                            <select class="form-select" id="aiService">
                                <option value="openai">OpenAI (ChatGPT)</option>
                                <option value="gemini">Google Gemini</option>
                                <option value="claude">Anthropic Claude</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">API Key</label>
                            <input type="password" class="form-control" id="aiApiKey" placeholder="sk-...">
                        </div>
                        <div class="form-group">
                            <div class="form-switch">
                                <label class="switch">
                                    <input type="checkbox" id="aiEnabled">
                                    <span class="slider"></span>
                                </label>
                                <span>فعال‌سازی AI</span>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveAISettings()">ذخیره</button>
                        <button class="btn" onclick="testAI()">تست اتصال</button>
                    </div>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">چت با AI</h3>
                </div>
                <div class="card-body">
                    <div class="ai-chat" id="aiChat">
                        <div class="ai-messages" id="aiMessages">
                            <div class="ai-message bot">
                                <div class="message-content">سلام! من دستیار هوشمند MXUI هستم. چطور می‌تونم کمکتون کنم؟</div>
                            </div>
                        </div>
                        <div class="ai-input">
                            <input type="text" class="form-control" id="aiInput" placeholder="سوال خود را بنویسید..." onkeypress="if(event.key==='Enter')sendAIMessage()">
                            <button class="btn btn-primary" onclick="sendAIMessage()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">قابلیت‌های AI</h3>
                </div>
                <div class="card-body">
                    <div class="ai-features">
                        <div class="ai-feature">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/>
                                </svg>
                            </div>
                            <div class="feature-info">
                                <div class="feature-name">عیب‌یابی خودکار</div>
                                <div class="feature-desc">شناسایی و رفع خودکار مشکلات سیستم</div>
                            </div>
                            <button class="btn btn-sm" onclick="aiAutoFix()">اجرا</button>
                        </div>
                        <div class="ai-feature">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33"/>
                                </svg>
                            </div>
                            <div class="feature-info">
                                <div class="feature-name">بهینه‌سازی تنظیمات</div>
                                <div class="feature-desc">پیشنهاد تنظیمات بهتر برای عملکرد</div>
                            </div>
                            <button class="btn btn-sm" onclick="aiOptimize()">اجرا</button>
                        </div>
                        <div class="ai-feature">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                            </div>
                            <div class="feature-info">
                                <div class="feature-name">مخفی‌سازی هوشمند</div>
                                <div class="feature-desc">پیشنهاد تنظیمات Obfuscation</div>
                            </div>
                            <button class="btn btn-sm" onclick="aiObfuscate()">اجرا</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Database Page Template -->
    <template id="tpl-database">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <ellipse cx="12" cy="5" rx="9" ry="3"/>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                        </svg>
                        بکاپ و ریستور
                    </h3>
                </div>
                <div class="card-body">
                    <div class="backup-section">
                        <button class="btn btn-primary btn-lg" onclick="createFullBackup()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            ایجاد بکاپ کامل
                        </button>
                        <button class="btn btn-lg" onclick="document.getElementById('restoreDbInput').click()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            بازیابی از فایل
                        </button>
                        <input type="file" id="restoreDbInput" accept=".zip" style="display:none" onchange="restoreFromFile(this.files[0])">
                    </div>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        ایمپورت از پنل دیگر
                    </h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">انتخاب پنل</label>
                        <select class="form-select" id="importPanelType">
                            <option value="">انتخاب کنید...</option>
                            <option value="marzban">Marzban</option>
                            <option value="mhsanaei">MHSanaei 3X-UI</option>
                            <option value="hiddify">Hiddify</option>
                            <option value="rebecca">Rebecca Panel</option>
                            <option value="pasarguard">Pasarguard VPN</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">فایل دیتابیس</label>
                        <input type="file" class="form-control" id="importDbFile" accept=".db,.sqlite,.sql,.zip,.json">
                    </div>
                    <div class="alert alert-info">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <div>
                            <strong>راهنما:</strong>
                            <ul>
                                <li>Marzban: فایل .db از /opt/marzban/</li>
                                <li>3X-UI: فایل x-ui.db از /etc/x-ui/</li>
                                <li>Hiddify: فایل hiddify.json یا دیتابیس</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="importFromPanel()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        شروع ایمپورت
                    </button>
                </div>
            </div>

            <div class="card glass">
                <div class="card-header">
                    <h3 class="card-title">تاریخچه بکاپ‌ها</h3>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>تاریخ</th>
                                    <th>حجم</th>
                                    <th>نوع</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="backupsTableBody">
                                <!-- Backups will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Mobile Profile Page Template -->
    <template id="tpl-profile-mobile">
        <div class="page-content fade-in">
            <div class="card glass">
                <div class="card-body">
                    <div class="profile-mobile-header">
                        <div class="profile-avatar-xl" id="mobileProfileAvatar">A</div>
                        <div class="profile-mobile-info">
                            <div class="profile-mobile-name" id="mobileProfileName">Admin</div>
                            <div class="profile-mobile-role" id="mobileProfileRole">مالک</div>
                        </div>
                    </div>
                    <div class="profile-mobile-stats">
                        <div class="profile-stat-item">
                            <div class="stat-value" id="mobileProfileUsers">0</div>
                            <div class="stat-label">کاربران</div>
                        </div>
                        <div class="profile-stat-item">
                            <div class="stat-value" id="mobileProfileTraffic">0 GB</div>
                            <div class="stat-label">ترافیک</div>
                        </div>
                        <div class="profile-stat-item">
                            <div class="stat-value" id="mobileProfileDays">0</div>
                            <div class="stat-label">روز فعال</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card glass">
                <div class="card-body">
                    <div class="profile-mobile-actions">
                        <button class="profile-mobile-btn" onclick="openChangePasswordModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0110 0v4"/>
                            </svg>
                            تغییر رمز عبور
                        </button>
                        <button class="profile-mobile-btn" onclick="openSettings()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33"/>
                            </svg>
                            تنظیمات
                        </button>
                        <button class="profile-mobile-btn danger" onclick="logout()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                            خروج
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="utils.js"></script>
    <script src="api.js"></script>
    <script src="panel.js"></script>
</body>
</html>
